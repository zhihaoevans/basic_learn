@startuml
start

:设置MAC防御标志;
:增加总数据包计数;
:解码网络层;
if (解码成功?) then (否)
  :设置无会话和解码丢弃标志;
  :增加解码丢弃数据包计数;
  :返回;
else (是)
  if (进行分段分析?) then (是)
    :设置无会话和分段分析标志;
    :增加分段分析数据包和字节计数;
    :添加到线路分析;
    if (时间到?) then (是)
      :生成输出文件路径;
      :输出分段分析结果;
    endif
    :清除IO标志;
    :执行L2防御判断;
    :返回;
  else (否)
    if (跨设备过滤?) then (是)
      :设置无会话和过滤丢弃标志;
      :增加过滤丢弃数据包和字节计数;
      :返回;
    else
      :执行L4过滤;
      if (L4过滤失败?) then (是)
        :设置无会话和过滤丢弃标志;
        :增加过滤丢弃数据包和字节计数;
        :返回;
      else
        :执行L2防御;
        if (L2防御失败?) then (是)
          :设置无会话和防御丢弃标志;
          :增加防御丢弃数据包和字节计数;
          :根据失败类型设置特定标志;
          :返回;
        else if (无IP?) then (是)
          :设置无会话、防御丢弃、无IP标志;
          :增加无IP防御丢弃数据包和字节计数;
          :返回;
        else (否)
          :继续处理数据包;
        endif
      endif
    endif
  endif
endif

@enduml